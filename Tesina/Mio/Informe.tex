
\documentclass[spanish]{article}
\usepackage[a4paper]{geometry}  % for page size and margin settings
\geometry{left=3.5cm, right=1cm, top=3cm, bottom=1.5cm}
\usepackage{graphicx}		    % for insert images
\usepackage[es-tabla]{babel} 	% for spanish titles
\usepackage{mathtools}          % for greek math symbol formatting
\usepackage{enumitem}           % for control of 'enumerate' numbering
\usepackage{listings}           % for control of 'itemize' spacing
\usepackage{indentfirst}		% package to make first paragraph always indented
\usepackage{hyperref}           % page numbers and '\ref's become clickable
\usepackage{bm}					% for bold maths
\usepackage{setspace}			% for setting interline spacing
\usepackage{amsmath}			% for matrices
\usepackage{tikz} 				% for graphs
\usepackage{multirow}			% for tables
\usepackage{float}				% to manually select placement of tables
\usepackage{autobreak}          % to automatically fit equations to page width
\usepackage{soul}				% for highlighting


\usetikzlibrary{babel}		    % for draw arrows in tikz using babel spanish
\doublespacing					% for use double interline spacing
\bibliographystyle{ieeetr}
\numberwithin{figure}{subsection}
\numberwithin{equation}{subsection}
\numberwithin{table}{subsection}

% TITLE VARIABLES 

\def\thesistitle{Incorporación de covariables que varían en el tiempo a un modelo mixto}
\def\thesisauthorfirst{\textbf{Esteban Cometto}}
\def\thesissupervisorfirst{Noelia Castellana}
\def\thesissupervisorsecond{Cecilia Rapelli}
\def\thesisdate{\today}

%% OTHER USEFUL VARIABLES 

\def\npatients{560}

%% FOR PDF METADATA
\title{\thesistitle}
\author{\thesisauthorfirst\space\thesisauthorsecond}
\date{\thesisdate}

\begin{document}

\begin{titlepage}
    \newcommand{\HRule}{\rule{\linewidth}{0.5mm}}
	\center
	\textsc{\Large Universidad Nacional de Rosario}\\[.7cm]
	\includegraphics[width=25mm]{img/fceye-unr.png}\\[.5cm]
	\textsc{Facultad de Ciencias Económicas y Estadística}\\[0.5cm]
	\textsc{Anteproyecto de Tesina}
	
	\HRule \\[0.4cm]
	{ \huge \bfseries \thesistitle}\\[0.1cm]
	\HRule \\[.5cm]
	
	\begin{minipage}{0.6\textwidth}
	\large
	\textit{Autor:}	\thesisauthorfirst
	\end{minipage}
	\\[.6cm]
	\begin{minipage}{0.6\textwidth}
	\textit{Directora:} 	\thesissupervisorfirst \\[.2cm]
	\textit{Codirectora:} 	\thesissupervisorsecond
	\end{minipage}
	\\[4cm]
	\vfill
	{\large \thesisdate}\\
	\clearpage
\end{titlepage}

\newpage
\tableofcontents

\newpage
\section{Introducción}

Los datos longitudinales están conformados por mediciones repetidas sobre una
unidad, las cuales pueden surgir por ser medidas en diferentes momentos o
condiciones. Su principal objetivo es estudiar los cambios en el tiempo y los
factores que influencian el cambio. 

Los modelos mixtos permiten ajustar datos con estas características, donde la
respuesta se modela por una parte sistemática que está compuesta por una
combinación de características poblacionales que son compartidas por todas las
unidades (efectos fijos), y una parte aleatoria que está constituida por efectos
específicos de cada unidad (efectos aleatorios) y por el error aleatorio, las
cuales reflejan las múltiples fuentes de heterogeneidad y correlación entre y
dentro de las unidades.

En estos modelos pueden incorporarse covariables. Las mismas se pueden
clasificar en 2 categorías: covariables no variables en el tiempo (CNVT) y
covariables variables en el tiempo (CVT). La naturaleza diferente de estas
covariables conduce a considerar distintos enfoques para cada una de ellas en el
análisis.

Las CNVT son variables independientes que no tienen variación intra-unidad, es
decir que el valor de la covariable no cambia para una unidad determinada en
el estudio longitudinal. Este tipo de covariables se pueden utilizar para
realizar comparaciones entre poblaciones y describir diferentes tendencias en el
tiempo.

Las CVT son variables independientes que contienen ambas variaciones, intra y
entre unidad, es decir que el valor de la covariable cambia para una unidad
determinada a lo largo del tiempo y además puede cambiar para diferentes
unidades. Este tipo de covariables tienen los mismos usos que las CNVT, y además
permiten describir la relación dinámica entre la CVT y la respuesta. Sin
embargo, esta relación puede estar confundida por valores anteriores y/o
posteriores de la covariable y en consecuencia esto puede conducir a inferencias
engañosas sobre los parámetros del modelo. Esta tesina realiza una introducción
a la problemática de incorporar covariables que varían en el tiempo en modelos
mixtos para datos longitudinales, presentando diferentes definiciones de las
mismas y enfoques metodológicos.

Estos conceptos se aplican a un conjunto de datos que surge del programa de
atención y control de pacientes hipertensos de Fundación ECLA llevado a cabo en
Rosario durante el período 2014-2019. Este estudio observacional realizó un
seguimiento de un grupo de pacientes hipertensos registrando en cada visita el
tratamiento farmacológico dado al paciente, los valores de la tensión arterial
sistólica (TAS) y la adherencia a dicho tratamiento entre otras características.
Uno de los objetivos que persiguió este estudio fue evaluar si la adherencia al
tratamiento influye en los valores de la TAS a lo largo del seguimiento. Como la
variable adherencia es una CVT, se presentarán diferentes enfoques para
incluirla en un modelo longitudinal mixto que pueda explicar el cambio en la
tensión arterial sistólica media a lo largo del tiempo.

\newpage
\section{Objetivos}

\subsection{Objetivo Principal}

Presentar diferentes propuestas metodológicas para la incorporación de
covariables que varían con el tiempo en modelos mixtos para datos
longitudinales.

\subsection{Objetivos Específicos}

\begin{itemize}
	\item Definir los tipos de covariables existentes.
	\item Describir propuestas de incorporación de covariables que varían en el
	tiempo en los modelos mixtos.
	\item Aplicar los conceptos vistos al programa de
	atención y control de pacientes hipertensos de Fundación ECLA.
\end{itemize}

\newpage
\section{Datos Longitudinales}

Los datos longitudinales están conformados por mediciones repetidas de una misma
variable realizadas sobre la misma unidad en diferentes momentos o condiciones
experimentales.

Dado que las mediciones repetidas son obtenidas de la misma unidad, los datos
longitudinales están agrupados. Las observaciones dentro de un mismo
agrupamiento generalmente están correlacionadas positivamente. Por lo tanto, los
supuestos usuales de independencia y homogeneidad de variancias no son válidos

Existen tres fuentes potenciales de variabilidad que influyen sobre la
correlación entre medidas repetidas:

\begin{itemize}
	\item \textit{Heterogeneidad entre las unidades:} Refleja la propensión
	natural de las unidades a responder. Las unidades tienen diferentes
	reacciones frente a los mismos estímulos.
	\item \textit{Variación biológica intra-unidad:} Se espera que la secuencia
	de medidas repetidas de una unidad tenga un comportamiento determinado, que
	produce que las mediciones más cercanas sean más parecidas entre sí que las
	más alejadas.
	\item \textit{Error de medición:} Errores aleatorios asociados al proceso de
	medición.
\end{itemize}

Estas tres fuentes de variación pueden clasificarse en \textit{``variabilidad
entre unidades''} (heterogeneidad entre unidades) y \textit{``variabilidad
intra unidades''} (variación biológica intra-unidad y error de medición)

Dado que estas fuentes de variabilidad introducen correlación, para el análisis
de datos longitudinales no se pueden utilizar las técnicas estadísticas
clásicas, sino que se deben utilizar métodos estadísticos especiales que
reconozcan las diferentes fuentes de variabilidad presentes en los datos. Los
modelos lineales mixtos constituyen la herramienta más utilizada para
representar datos correlacionados.

\section{Covariables en datos longitudinales}

En los estudios longitudinales, las variables independientes pueden ser
clasificadas en dos categorías: CNVT y CVT. La diferencia entre
ellas puede conducir a diferentes enfoques de análisis así como también a
diferentes conclusiones.

Tanto las CNVT como las CVT se pueden utilizar para realizar comparaciones entre
poblaciones y describir diferentes tendencias a lo largo del tiempo. Sin
embargo, sólo las CVT permiten describir una relación dinámica entre la
covariable y la variable respuesta.

Para introducir los conceptos referentes a los tipos de covariables en los
estudios longitudinales se supone que se cuenta con la variable respuesta $Y$ y
una sola covariable $X$. Se obtiene una muestra aleatoria de $N$ unidades, cada
una con $n$ mediciones repetidas de la variable respuesta y de la covariable
observadas en los tiempos $t_1, ..., t_n$ (se asume que los tiempos de medición
son los mismos para todas las unidades). El número total de observaciones es
$N*=Nn$.

Sean $Y_{ij}$ y $X_{ij}$ los valores de la variable respuesta y de la variable
independiente respectivamente, medidos para la unidad $i$ en la ocasión $t_j$
con $i = 1, ..., N$ y $j = 1, ..., n$ Si se asume que $Y_{ij}$ y $X_{ij}$ son
simultáneamente medidas, en un análisis de corte transversal, $Y_{ij}$ y
$X_{ij}$ se correlacionarían directamente. Sin embargo, para un análisis
longitudinal se debe asumir que existe un orden pre-establecido:
$(X_{i1}, Y_{i1}), (X_{i2}, Y_{i2}), ..., (X_{in}, Y_{in})$

\subsection{Covariables fijas en el tiempo}

Las CNVT son variables independientes que no presentan variación intra-unidad,
es decir, los valores de estas covariables no cambian a lo largo del estudio
para una unidad en particular.

Éstas covariables pueden ser fijas por naturaleza (por ejemplo, el sexo
biológico de una persona o el grupo de tratamiento) o pueden ser covariables
basales (es decir, medidas al inicio del estudio). Las covariables basales son
fijas por definición pero pueden ser variables en el tiempo por naturaleza, por
ejemplo, la edad varia en el tiempo pero la edad basal es fija.

\subsection{Covariables variables en el tiempo}

Las CVT son variables independientes que incluyen tanto la variación
intra-unidad como la variación entre-unidad. Esto significa que, para una unidad
en particular, el valor de la covariable cambia a través del tiempo y puede
cambiar también entre diferentes unidades. Por ejemplo, el valor del colesterol
o la condición de fumador (si/no).

A continuación se describen diferentes tipos de CVT.

\subsubsection{Covariables estocásticas y no estocásticas}

Las CVT pueden clasificarse en estocásticas y no estocásticas. Las CVT no
estocásticas son covariables que varían sistemáticamente a través del tiempo
pero son fijas por diseño del estudio o bien su valor puede predecirse. En
cambio, las CVT estocásticas son covariables que varían aleatoriamente a través
del tiempo, es decir, los valores en cualquier ocasión no pueden ser estimados
ya que son gobernados por un mecanismo aleatorio. Ejemplos de las primeras son:
tiempo desde la visita basal o edad. Ejemplos de las segundas son: valor del
colesterol, ingesta de alcohol (si/no), ingesta de grasas, etc.

\subsubsection{Covariables exógenas y endógenas}
\label{seccion_de_exogeneidad}

Otra clasificación de las CVT es en exógenas y endógenas.

\paragraph{Covariables exógenas} \mbox{}

Una CVT estocástica se define como exógena, respecto a la variable respuesta, si
el valor de la covariable en un determinado momento, dado los valores previos de
la covariable y de la respuesta, es condicionalmente independiente de todos los
valores precedentes de la variable respuesta (Diggle et al., 2002). Formalmente,
para la unidad $i$ en la ocasión $j$:  

\begin{equation}
	\label{exogeneidad}
	f(X_{ij}|X_{i1}, ..., X_{ij-1}, Y_{i1}, ..., Y_{ij}) =
	f(X_{ij}|X_{i1}, ..., X_{ij-1})
\end{equation}

Y en consecuencia (Diggle et al., 2002; Fitzmaurice et al., 2004):

\begin{equation}
	\label{exogeneidad debil}
	E(Y_{ij}|X_{i1}, ..., X_{in}) = E(Y_{ij}|X_{i1}, ..., X_{ij})
\end{equation}

Esta definición implica que la media condicional de la variable respuesta en un
determinado momento dado todo los valores de la covariable (previos y
posteriores) sólo depende de los valores previos de la covariable. Por ejemplo,
en un estudio longitudinal en donde se evalúa si el la cantidad de actividad
física (variable explicativa) esta asociada al nivel de glucosa en sangre
(variable respuesta), según (\ref{exogeneidad debil}), la media condicional de
la glucosa en un determinado momento dado todos los registros de actividad
física (previos y posteriores) sólo depende de los registros previos de
actividad física. También, (\ref{exogeneidad}) sugiere que es de esperar que la
cantidad de actividad física en una determinada ocasión dependa de la cantidad
de actividad física observa en momentos previos, pero no se espera que dependa
de los niveles de glucosa observados previamente.

Es posible examinar empíricamente la suposición de que una CVT es exógena
ajustando un modelo de regresión en donde se considera como variable respuesta a
la covariable en un momento determinado ($X_{ij}$) y como variables explicativas
tanto a los valores previos de la covariable ($X_{i1}, ..., X_{ij-1}$) como a
los valores previos de la variable respuesta ($Y_{i1}, ..., Y_{ij-1}$). Si,
después de controlar por los valores previos de la covariable, el valor actual
de la covariable no muestra una asociación con los valores previos de la
variable respuesta, puede considerarse que la covariable es exógena.

Cuando se puede asumir que las CVT son exógenas con respecto a la variable
respuesta, se puede dar una interpretación causal a los parámetros de regresión.

\paragraph{Covariables endógenas} \mbox{}

Una CVT que no es exógena se define como endógena. Una variable endógena es una
variable estocásticamente relacionada con otros factores medidos en el estudio.
Esta también puede definirse como una variable generada por un proceso
estocástico relacionado con el individuo en estudio. En otras palabras, las CVT
endógenas están asociadas con un efecto individual y, a menudo, pueden
explicarse por otras variables en el estudio. Cuando el proceso estocástico de
una CVT endógena puede ser (al menos parcialmente) explicado por la variable
respuesta, se dice que hay \textit{feedback} entre la respuesta y la CVT
endógena. Por ejemplo, cuando se evalúa si la cantidad de actividad física está
asociada al nivel de glucosa. El nivel de actividad física en un determinado
momento puede estar (o no) asociado a niveles previos y también puede estar
asociado a valores previos de glucosa (un paciente con valor de glucosa alto
en una visita puede decidir aumentar su nivel de actividad fística para ver si
este valor se reduce).

\section{Modelo lineal mixto}

Los modelos lineales mixtos se utilizan habitualmente para analizar los datos
longitudinales, debido a que permiten modelar las distintas fuentes de
variabilidad presentes en los mismos.

En estos modelos, la respuesta media se modela como una combinación de
características poblacionales que son comunes a todos los individuos (efectos
fijos) y efectos específicos de la unidad que son únicos de ella (efectos
aleatorios).

El modelo lineal mixto para la unidad $i$ se puede expresar en forma matricial
como:

\[
	\bm{Y}_i = \bm{X}_i\bm{\beta} + \bm{Z}_i\bm{b}_i + \bm{\varepsilon}_i;
	\quad i = 1, ..., N;
\]

Donde:

\begin{itemize}
	\item $\bm{Y}_i$: Vector de la variable respuesta de la i-ésima unidad, de
	dimensión $(n \times 1)$, siendo $\bm{Y}_i = (Y_{i1}, Y_{i2}, ... Y_{in})'$
	\item $\bm{X}_i$: Matriz de diseño de la i-ésima unidad, que caracteriza la
	parte sistemática de la respuesta, de dimensión $(n \times p)$
	\item $\bm{\beta}$: Vector de parámetros de dimensión $(p \times 1)$
	\item $\bm{Z}_i$: Matriz de diseño de la i-ésima unidad, que caracteriza la
	parte aleatoria de la respuesta, de dimensión $(n \times k)$
	\item $\bm{b}_i$: Vector de efectos aleatorios de la i-ésima unidad, de
	dimensión $(k \times 1)$
	\item $\bm{\varepsilon}_i$: Vector de errores aleatorios de la i-ésima unidad,
	de dimensión $(n \times 1)$
\end{itemize}

Se supone que $\bm{\varepsilon}_i$ y $\bm{b}_i$ son independientes.

\[ \bm{\varepsilon}_i \sim N_{n}(0, \bm{R}_i) \quad \bm{b}_i \sim N_k(0, \bm{D}) \]

$\bm{D}$ y $\bm{R}_i$ son las matrices de variancias y covariancias de los
vectores $\bm{b}_i$ y $\bm{\varepsilon}_i$ respectivamente. A partir de este
modelo se obtiene:

\begin{itemize}
	\item $E(\bm{Y}_i/\bm{b}_i) = \bm{X}_i\bm{\beta} + \bm{Z}_i\bm{b}_i$ (media condicional o específica de
	la i-ésima unidad)
	\item $E(\bm{Y}_i) = \bm{X}_i\bm{\beta}$ (media marginal)
	\item $Cov(\bm{Y}_i/\bm{b}_i) = \bm{R}_i$ (variancia condicional)
	\item $Cov(\bm{Y}_i) = \bm{Z}_i \bm{D}_i \bm{Z}'_i + \bm{R}_i = \bm{\varSigma}_i$ (variancia marginal)
\end{itemize}

Generalmente, la matriz $\bm{D}$ adopta una estructura de covariancia
arbitraria, mientras que la matriz $\bm{R}_i$ adopta otra estructura que modela
apropiadamente la variabilidad intra individuo.

\subsection{Estimación de los parámetros del modelo}

Bajo el supuesto de que $\bm{\varepsilon}_i$ y $\bm{b}_i$ se distribuyen normalmente se
pueden usar métodos de estimación basados en la teoría de máxima verosimilitud,
cuya idea es asignar a los parámetros el valor más probable en base a los datos
que fueron observados. Se usarán para estimar los parámetros de la parte media
y los de las estructuras de covariancia los métodos de máxima verosimilitud
(ML) y máxima verosimilitud restringida (REML) respectivamente

\subsubsection{Método de máxima verosimilitud (ML)}

Bajo el supuesto de que $\bm{Y}_i \sim N_n(\bm{X}_i \bm{\beta},
\bm{\varSigma}_i)$ y las $\bm{Y}_i$
son independientes entre sí, se obtiene la siguiente función de
log-verosimilitud:

\begin{equation}
\label{ML}
	l = -\frac{1}{2} \sum_{i=1}^{N}n \ln(2\pi) - \frac{1}{2}\ln|\bm{\varSigma}_i| -
	\frac{1}{2} \sum_{i=1}^{N} [(\bm{Y}_i - \bm{X}_i\bm{\beta})'
	\bm{\varSigma}_i^{-1} (\bm{Y}_i - \bm{X}_i\bm{\beta})]
\end{equation}

Siendo $\bm{\varSigma}_i$ función del vector $\bm{\theta}$ que contiene los
parámetros de covariancia.

Los estimadores de $\bm{\beta}$ y $\bm{\theta}$ son los valores que maximizan
esta expresión. Cuando $\bm{\theta}$ es desconocido (lo que generalmente sucede)
se obtiene una ecuación no lineal, por lo que no se puede obtener una expresión
explícita de $\hat{\bm{\theta}}$. Para encontrar su solución se recurre a
métodos numéricos. El estimador del vector $\bm{\beta}$ resulta:

\[ \hat{\bm{\beta}} = (\sum_{i=1}^{N} \bm{X}_i'\hat{\bm{\varSigma}_i}^{-1}\bm{X}_i)^{-1}
\sum_{i=1}^{N} \bm{X}'_i\hat{\bm{\varSigma}_i}^{-1}\bm{Y}_i \]

El estimador $\hat{\bm{\beta}}$ resulta insesgado de $\bm{\beta}$. Cuando
$\bm{\theta}$ es desconocido no se puede calcular de manera exacta la matriz
de covariancias de $\hat{\bm{\beta}}$. Si el número de unidades es grande se
puede demostrar que asintóticamente (Fitzmaurice et al., 2004):

\[ \hat{\bm{\beta}} \sim N_p(\bm{\beta}, \bm{V}_{\bm{\beta}}) \quad donde \quad \bm{V}_{\bm{\beta}} =
(\sum_{i=1}^{N} \bm{X}'_i\hat{\bm{\varSigma}_i}^{-1}\bm{X}_i)^{-1} \]

\subsubsection{Método de máxima verosimilitud restringida (REML)}

El inconveniente que posee el método de ML es que los parámetros de covariancia
resultan sesgados. Es decir, a pesar de que $\bm{\hat{\beta}}$ es un estimador
insesgado de $\bm{\beta}$, no pasa lo mismo con $\bm{\hat{\theta}}$. Si el
tamaño de muestra es chico, los parámetros que representan las variancias van a
ser demasiado pequeños, dando así una visión muy optimista de la variabilidad de
las mediciones, es decir, se subestiman los parámetros de covariancia. El sesgo
se debe a que en la estimación ML de $\bm{\theta}$ no se tiene en cuenta que
$\bm{\beta}$ es estimado a partir de los datos.

Distintos autores proponen el método de REML para estimar los parámetros del
modelo. Este método es una modificación del método de máxima verosimilitud, en
el que la parte de los datos usada para estimar $\bm{\beta}$ está separada de
aquella usada para estimar los parámetros de $\bm{\varSigma}_i$. La función de
log-verosimilitud restringida que se propone es:

\begin{equation}
\label{REML}
	\bm{l}^* = -\frac{1}{2} \sum_{i=1}^{N}n \ln(2\pi) - \frac{1}{2}\ln|\bm{\varSigma}_i| -
	\frac{1}{2} \sum_{i=1}^{N} [(\bm{Y}_i - \bm{X}_i\bm{\beta})'
	\bm{\varSigma}_i^{-1} (\bm{Y}_i - \bm{X}_i\bm{\beta})] -
	- \frac{1}{2} \ln |\sum_{i=1}^{N} \bm{X}'_i \hat{\bm{\varSigma}_i^{-1} \bm{X}_i}|
\end{equation}

Maximizando esta funcion con respecto a $\bm{\beta}$ y $\bm{\theta}$ se obtiene:

\[ \hat{\bm{\beta}} = (\sum_{i=1}^{N} \bm{X}'_i \hat{\bm{\varSigma}}_i^{-1} \bm{X}_i)^{-1}
\sum_{i=1}^{N} \bm{X}'_i \hat{\bm{\varSigma}}_i^{-1} \bm{Y}_i\]

Donde $\hat{\bm{\varSigma}}_i$ es el estimador REML de ${\bm{\varSigma}_i}$ (Fitzmaurice et al., 2004).

\subsubsection{Problemas con la estimación}

Pepe y Anderson (1994) mostraron que las ecuaciones (\ref{ML}) y (\ref{REML}) llegan
a cero solo si se cumple con el supuesto de independencia condicional:

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% REMOVER ESPACIO MUCHO ESPACIO ANTES DE LA ECUACION %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{equation}
\label{estimation_issue}
	E[Y_{ij} | X_{ij}] = E[Y_{ij} | X_{ij}, j = 1, ..., n]
\end{equation}

Con las CNVT, esta suposición se mantiene necesariamente ya que $X_{ij} =
X_{ik}$ para todo $j, k = 1, ..., n$. Con las CVT estocásticas, que se
fijan por diseño del estudio (por ejemplo, indicador de grupo de tratamiento en
una prueba cruzada), la suposición también se cumple ya que los valores de las
covariables en cualquier ocasión se determinan a priori por diseño del estudio y
de manera completamente no relacionado con la respuesta longitudinal. Sin
embargo, cuando una covariable es variable en el tiempo no estocástica, puede
que no necesariamente se mantenga.

En general, cuando (\ref{estimation_issue}) no se cumple, los valores
precedentes y/o posteriores de la CVT confunden la relación entre $Y_{ij}$ y
$X_{ij}$, esto puede llevar a estimaciones sesgadas de los parámetros del
modelo.

Frente a este escenario, Pepe y Anderson (1994) recomendaron plantear el modelo
longitudinal marginal y realizar las estimaciones mediante GEE (ecuaciones de
estimación generalizadas) con estructura de correlación independiente ya que
este es siempre consistente. La estructura de correlación independiente
generalmente tiene una alta eficiencia para la estimación de los coeficientes
asociados a CNVT. Sin embargo, para las CVT, Fitzmaurice (1995) muestra que esta
estructura puede resultar en una pérdida sustancial de eficiencia para la
estimación de los coeficientes asociados a las CVT y proporciona un ejemplo en
el que la elección de dicha estructura tiene una eficiencia del 60\% en relación
con la estructura de correlación verdadera.

Lai y Small (2007) y Lalonde et. al (2014) definieron cuatro tipos de CVT y
propusieron utilizar el ``Método generalizado de los momentos'' (Hansen, 1982)
en donde es posible incorporar información sobre la naturaleza de la CVT que se
esta analizando.

% Luego, Lai y Small (2007) y Lalonde (2014) definieron 4 nuevos tipos de CVT:

% \begin{itemize}
% 	\item Tipo I: una CVT es de Tipo I si no hay relación entre la
% 	CVT y la variable respuesta en diferentes ocasiones. Las variables que
% 	involucran cambios predecibles a lo largo del tiempo, como la edad o el
% 	tiempo de observación, generalmente se tratan como Tipo I.
% 	\item Tipo II: una CVT es de Tipo II si no está asociada a valores
% 	anteriores de la variable respuesta, pero la variable respuesta si puede
% 	estar asociada a valores previos de la CVT. Un ejemplo de este tipo de CVT
% 	puede ser la medicación para la presión arterial con respecto a la variable
% 	respuesta presión arterial, ya que valores acumulados de la medicación en
% 	el tiempo se espera que tengan un impacto en la presión arterial en
% 	cualquier ocasión.
% 	\item Tipo III: para éste tipo, no hay suposición de independencia entre la
% 	respuesta y los valores de la CVT en diferentes ocasiones. Por lo tanto, una
% 	CVT de Tipo III puede implicar un ciclo de feedback entre la CVT y la
% 	respuesta, en el que los valores de la covariable pueden verse afectados por
% 	los valores anteriores de la respuesta. Un ejemplo de este tipo es la CVT
% 	medicación para la presión arterial con la respuesta infarto de miocardio.
% 	Mientras que es esperado que la medicación impacte en la probabilidad de
% 	infarto, un evento de infarto puede provocar un cambio en la medicación para
% 	la presión arterial.
% 	\item Tipo IV: para una CVT de Tipo IV, la covariable puede estar asociada a
% 	valores previos de la variable respuesta, pero la respuesta no está asociada
% 	a valores previos de la CVT. Un ejemplo es la CVT presión arterial con la
% 	variable respuesta peso. Si bien existe una asociación entre el peso y la
% 	presión arterial, la dirección del efecto parece ser que el peso afecta la
% 	presión arterial, pero es poco probable que ocurra lo contrario.
% \end{itemize}

% Además, propusieron utilizar el ``Método generalizado de los momentos'' (GMM)
% (Hansen, 1982). Éste método puede ser utilizado para tratar a cada CVT de manera
% diferente, dependiendo del tipo de cada una, y evita problemas con la estimación
% de ecuaciones construidas a partir de componentes no independientes.

En conclusión, si la CVT es exógena, puede introducirse el modelo lineal mixto
de manera tradicional y mediante ciertas transformaciones. Sin embargo, si la
CVT es endógena, no puede introducirse al modelo lineal mixto en su formato
original y deben explorarse las propuestas planteadas anteriormente. 

\newpage

\section{Formas de introducir una CVT al modelo lineal mixto}

Si al evaluar el tipo de la CVT de la manera vista en
(\ref{seccion_de_exogeneidad}) resulta ser exógena, se puede introducir en el
modelo lineal mixto sin consideraciones adicionales. Esto se debe a que no habrá
problemas con la estimación de los parámetros, ya que se cumple el supuesto de
independencia condicional.

A continuación, se presentan distintas maneras de introducir la CVT exógena a un
modelo lineal mixto con ordenada aleatoria. De manera de ejemplo, se tomará un
caso en el que la variable respuesta $Y_{ij}$ y la CVT $X_{ij}$ son la tensión
arterial y el IMC, respectivamente, del paciente $i$ en la ocasión $j$ con
$i = 1, ..., N; j = 1, ..., n$.

Para todos los modelos se supone que $\bm{\varepsilon}_i$ y $b_{0i}$ son
independientes.

\[ 
	\bm{\varepsilon}_i = \begin{pmatrix} \varepsilon_{i1} \\ \vdots \\ \varepsilon_{in} \end{pmatrix} \sim N_{n}(0, \bm{R}_i)
	\quad
	b_{0i} \sim N(0, Var(b_{0i}))
\]

\subsection{Convertirla en CNVT}

Una solución rápida al problema de las CVT, sea exógena o endógena, es
transformarla en una CNVT, esto se puede lograr resumiendo la información de la
misma mediante alguna función como el promedio de los valores de cada individuo
y dejarlo fijo a través del tiempo. También podria usarse su valor máximo,
mínimo o cualquier transformación que resulte de interés en el estudio. El
problema de este enfoque es que se pierde información, dado que se usa una
covariable más simple que no refleja la relación dinámica entre la covariable y
la respuesta en el tiempo.

En el ejemplo mencionado anteriormente, se podría calcular el IMC promedio de
cada uno de los individuos y el modelo resultaría:

\[ Y_{ij} = \beta_0 + b_{0i} + \beta_1\ \overline{X}_i + \beta_2\ t_j + \varepsilon_{ij} \]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PONER O NO PONER INTERPRETACION? %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
El coeficiente $\beta_1$ se interpreta como el cambio esperado en la media de la
tensión arterial por incrementos unitarios en el IMC promedio (obsrvado durante
todo el seguimiento) para un momento determinado en el seguimiento.

\subsection{Covariable variable en el tiempo}

Dado que la CVT es exógena, se puede incorporar al modelo sin ninguna
transformación. El modelo resultante es,

\[ Y_{ij} = \beta_0 + b_{0i} + \beta_1\ X_{ij} + \beta_2\ t_j + \varepsilon_{ij} \]

%%%% LESSA HOFFMAN PAGINA 345

\subsection{Covariable rezagada}

En algunas aplicaciones hay justificacion previa para considerar la covariable
en el rezago $k$ momentos antes de la medición de la respuesta. Por ejemplo, el
efecto del IMC sobre la tensión arterial probablemente no sea inmediato, por lo
que podría interesarnos su valor en la ocasión anterior ($k=1$). Lo más común es
que se desconozca el valor $k$ apropiado y se consideren varias opciones
diferentes. El modelo lineal mixto se definiría de la siguiente manera:

\[ Y_{ij} = \beta_0 + b_{0i} + \beta_{1k}\ X_{ij-k} + \beta_2\ t_j + \varepsilon_{ij} \]

En este modelo, el coeficiente $\beta_{1k}$ depende explícitamente de la
elección del rezago $k$.

\subsection{Funcion de las covariables rezagadas}

Una alternativa cuando se quiere utilizar toda la información con la que se
cuenta de la covariable hasta la ocasión actual es resumir la misma a través de
una función. Un ejemplo puede ser el valor promedio o acumulado hasta la ocasión
actual. Sin embargo, la elección de está funcion dependerá del tipo de problema
a analizar. Cabe destacar que, al igual que con toda medida resumen, al usar
este tipo de covariables se pierde parte de la información. En el ejemplo
mencionado, podría ser de interés calcular el IMC promedio hasta la ocasión $j$,
resultando el modelo:

\[ Y_{ij} = \beta_0 + b_{0i} + \beta_1\ \overline{X}_{ij} + \beta_2\ t_j + \varepsilon_{ij} \]

Donde $\overline{X}_{ij}$ es el IMC promedio calculado hasta la ocasión $j$ para
el $i$-ésimo paciente.

\subsection{Dividiendo efecto entre-unidad y efecto intra-unidad}
\label{Dividiendo efecto entre-unidad y efecto intra-unidad}

Otra forma de incorporar la CVT es dividiendo el efecto en dos componentes que
reflejen la variación intra-unidad y la variación entre-unidades respecto de la
CVT. Por lo tanto, el término del modelo que representa a la covariable se puede
descomponer en dos términos:
\[ \beta X_{ij} \rightarrow \beta_W (X_{ij} - \overline{X}_i) + \beta_B \overline{X}_i \]
El modelo lineal mixto queda planteado del siguiente modo:

\[ 
	Y_{ij} = \beta_0 + b_{0i} + \beta_W\ (X_{ij} - \overline{X}_i) + \beta_B\ \overline{X}_i
	+ \beta_2\ t_j + \varepsilon_{ij}
\]

Donde, $\overline{X}_i$ representa el promedio de todos los valores observados
en el tiempo de la CVT para la unidad $i$, es decir, el promedio del IMC para
cada paciente.

$\beta_W$ representa el cambio esperado en la media de la tensión arterial
asociado con variaciones del IMC propias de cada paciente (controlando por el
tiempo). $\beta_B$ representa el cambio esperado en la media de la tensión
arterial asociado con las variaciones del IMC entre pacientes (controlando por
el tiempo)

Cabe destacar que cuando la covariable es dicotómica (que toma valores 0 y 1) la
componente $(X_{ij} - \overline{X}_i)$ tomará solamente dos valores y en
consecuencia se sugiere dejar esta componente solamente con el valor de $X_{ij}$
sin centrar respecto al valor promedio (Hoffman, 2015).

\newpage

\section{Aplicación}

A partir del programa de atención y control de pacientes hipertensos iniciado en
el año 2014 en Rosario se obtienen datos de \npatients{} pacientes de entre 30 y
86 años, con una edad media de 58.84 y desvío estándar de 9.87 años, de los
cuales un 49.28\% son hombres. A todos estos pacientes se les indicó un
tratamiento antihipertensivo al incio del seguimiento (visita basal). Durante 7
meses se agendaron visitas mensuales en donde se registraron, entre otras
características, el valor de la TAS y la adherencia al tratamiento. Esta última
variable surge de la evaluación del cuestionario Morisky (Morisky et al., 1986)
que arroja como resultado: adhiere al tratamiento, no adhiere al tratamiento. Al
ser evaluada en todas las visitas mensuales, esta variable dicotómica es una CVT
que captura como fue la adherencia durante el periodo desde la visita previa
hasta la visita actual. Como para la visita basal no se cuenta con información
de adherencia, se toman los datos desde el primer mes de tratamiento.

Uno de los objetivos que persiguió este estudio fue evaluar si la adherencia
influye en los valores de la TAS a lo largo del seguimiento.

Para dar respuesta a este interrogante se propuso ajustar un modelo longitudinal
de efectos mixtos considerando a la TAS como variable respuesta y la adherencia,
sexo y edad como variables explicativas.

Para todas las decisiones de esta sección se utilizará un nivel de significación
del 5\%.

\subsection{Nomenclatura}
\label{variables}

A continuación se describen las variables originales que se encuentran en el
dataset y sus distintas transformaciones transformaciones.

Siendo $ i = 1, ..., \npatients{}$ y $j = 1, ..., 7$ se obtienen:

\begin{itemize}
	\item $TAS_{ij}$: tension arterial sistólica (mmHg) del paciente $i$ en el
	mes $j$.
	\item $\overline{TAS}_{i}$: tension arterial sistólica (mmHg) promedio del
	paciente $i$ a lo largo del seguimiento ($\sum_{k=0}^n \frac{TAS_{ik}}{n}$).
	\item $\overline{TAS}_{ij}$: tension arterial sistólica (mmHg) promedio del
	paciente $i$ hasta el mes $j$ ($\sum_{k=0}^j \frac{TAS_{ik}}{j}$).
	\item $sexo_i$: sexo del paciente $i$ medido como una variable dicotómica
	(0=mujer, 1=homobre) en la ocasión basal (mes 0).
	\item $edad_i$: edad del paciente $i$ medido en la ocasión basal (mes 0).
	\item $mes_j$: meses transcurridos desde el inicio del tratamiento hasta la
	ocasión $j$.
	\item $adherencia_{ij}$: adherencia al tratamiento del paciente $i$ en el
	mes $j$ (variable dicotómica: =1 si adhiere, =0 si no adhiere).
	\item $\overline{adherencia}_i$: proporción de visitas en las que el
	paciente $i$ adhirió al tratamiento a lo largo del seguimiento
	($\sum_{k=0}^n \frac{adherencia_{ik}}{n}$).
	\item $\overline{adherencia}_{ij}$: proporción de visitas en las que el
	paciente $i$ adhiere al tratamiento hasta el mes $j$ ($\sum_{k=0}^j
	\frac{adherencia_{ik}}{j}$).
	\item $adherencia\ perfecta_i$: variable indicadora, $=1$ si el paciente
	$i$ adhirió al tratamiento todos los meses, $=0$ en otro caso.
\end{itemize}

\subsection{Análisis descriptivo}

En esta sección se presentaran diversos gráficos con el fin de describir la
población en estudio.

En la figura (\ref{TAS_vs_tpo}) se puede observar que luego de un mes de
tratamiento (mes 1) la TAS promedio es de aproximadamente 133, la cual fue
disminuyendo levemente de manera lineal hasta un promedio de aproximadamente 130
al final del tratamiento.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{img/TAS_vs_tpo.png}
	\caption{Evolución de la TAS promedio a lo largo del tratamiento}
	\label{TAS_vs_tpo}
\end{figure}

También resulta de interés observar la evolución de la TAS en el tiempo según la
edad y sexo de los pacientes. Como la variable edad es continua, para tal fin,
se la categorizó en 2 grupos (<59 añosy >= 59 años, donde 59 es la mediana de la
edad de los pacientes estudiados). En la figura (\ref{TAS_with_covs}) se observa
que los perfiles promedios presentan (en general) una pendiente decreciente, es
decir, la TAS media disminuye con el transcurso del tratamiento. Este
comportamiento es similar para los grupos, observando valores superiores de TAS
para los pacientes de sexo masculino y para los pacientes mayores de 59 años. 

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.4]{img/TAS_vs_tpo_with_covs.png}
	\caption{Evolución de la TAS promedio a lo largo del tratamiento según sexo y edad}
	\label{TAS_with_covs}
\end{figure}

Para poder visualizar la relación entre la adherencia al tratamiento, el tiempo
de seguimiento y la TAS media no es posible realizarlo con los gráficos de
perfiles promedio. La covariable ``adherencia al tratamiento'' es una CVT y en
consecuencia para cada individuo puede presentar distintos valores en cada
ocasión, es decir, los pacientes no mantienen un perfil constante a lo largo del
tiempo. En una primera instancia es posible realizar un diagrama de dispersión
entre la TAS y el tiempo (mes) según adherencia. Para poder observar con mayor
claridad la relación entre estas variables se utiliza la técnina ``jitter'', la
cual agrega un pequeño desplazamiento en los puntos, evitando que queden
perfectamente solapados. A partir de la figura (\ref{TAS_with_adh_scatter}) se
puede notar que esta manera de visualizar el efecto de la adherencia sobre la
TAS resulta confusa.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{img/TAS_vs_tpo_with_adherencia_scatter.png}
	\caption{Valores de la TAS a través del tiempo según adherencia}
	\label{TAS_with_adh_scatter}
\end{figure}

Como una alternativa a la presentada previamente, se propone realizar un gráfico
de perfiles promedio convirtiendo a la CVT (adherencia) en una CVNT para que de
esta manera cada paciente pertenezca únicamente a un sólo grupo durante todo el
periodo del estudio. Para esto, se dividieron a los pacientes según la cantidad
de meses que adhirieron al tratamiento, formando los grupos: 3 meses o menos
(adherencia baja), entre 4 y 6 meses (adherencia media/alta) o todos los meses
(adherencia perfecta). En la figura (\ref{TAS_with_adh}) Se puede observar que
para el grupo de pacientes que adhirieron al tratamiento 3 meses o menos la TAS
presenta una pendiente creciente a lo largo del estudio. Para los otros 2
grupos, la TAS disminuye a lo largo del tratamiento, siendo menor para el grupo
de pacientes que adhirieron la totalidad de los meses.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{img/TAS_vs_tpo_with_adherencia.png}
	\caption{TAS a través del tiempo según perfiles de adherencia al tratamiento}
	\label{TAS_with_adh}
\end{figure}

\subsection{Evaluación de la exogeneidad}

Para evaluar la exogeneidad de la variable adherencia es necesario verificar el
supuesto de independencia condicional descripta en
(\ref{seccion_de_exogeneidad}). Esto puede realizarse ajustando un modelo para
cada ocasión en el que se considere a la variable adherencia como variable
respuesta y como variables explicativas a la TAS y la adherencia en ocasiones
previas. Si, en estos modelos, las variables referentes a la TAS registrada en
ocasiones previas no resultan ser significativas puede decirse que la adherencia
es una CVT exógena. Cómo la CVT adherencia es una variable dicotómica, se
ajustan modelos de regresión logística.

Para ajustar estos modelos se utilizarán como covariables a la adherencia y la
TAS en el mes anterior, ya que se asume que las mediciones más cercanas entre sí
están más correlacionadas y tambien se utilizarán la adherencia y la TAS
promedio desde el inicio hasta 2 meses antes, de esta manera se puede utilizar
toda la información del estudio. El modelo para la ocasión $j$ ($j = 1, ..., 7$)
resulta:

$ 
	logit(adherencia_{ij}) = \beta_0 + \beta_1\ adherencia_{ij-1} + \beta_2\ TAS_{ij-1}
	+ \beta_3\ \overline{adherencia}_{ij-2} + \beta_4\ \overline{TAS}_{ij-2}
$

En la tabla (\ref{exog_table}) se presentan los valores de los coeficientes para
cada covariable y en paréntesis la probabilidad asociada a cada uno. Como se
puede notar, en ninguna ocasión la adherencia depende de valores anteriores de
la TAS (cuando se controla por los valores previos de la adherencia), por lo
tanto puede considerarse como una covariable exógena.

\begin{table}[H]
	\centering
	\caption{Estimación de coeficientes de los modelos logit y sus respectivas probabilidades asociadas}
	\label{exog_table}
	\begin{tabular}{*{5}{|c}|}
		\hline
		mes\ (j) & $adherencia_{ij-1}$ & $\overline{adherencia}_{ij-2}$ & $TAS_{ij-1}$ &
		$\overline{TAS}_{ij-2}$ \\
		\hline
		\hline
		$2$ & $1.9302\ (<0.001)$ & $-$ & $0.0057\ (0.45)$ & $-$ \\
		$3$ & $2.3047\ (<0.001)$ & $0.5683\ (0.044)$ & $-0.0088\ (0.343)$ &
		$0.0075\ (0.419)$ \\
		$4$ & $1.9689\ (<0.001)$ & $1.0734\ (0.002)$ & $0.0138\ (0.17)$ &
		$-0.017\ (0.138)$ \\
		$5$ & $2.2945\ (<0.001)$ & $1.0617\ (0.007)$ & $0.0092\ (0.441)$ &
		$-0.0141\ (0.307)$ \\
		$6$ & $2.2741\ (<0.001)$ & $1.0698\ (0.015)$ & $-0.0008\ (0.938)$ &
		$<0.0001\ (0.996)$ \\
		$7$ & $2.5812\ (<0.001)$ & $1.4609\ (0.003)$ & $-0.0005\ (0.966)$ &
		$-0.0072\ (0.678)$ \\
		\hline
	\end{tabular}
\end{table}

\subsection{Modelo lineal mixto propuesto}

Mediante la inspección del semivariograma muestral, pruebas de hipótesis para
efectos aleatorios y comparación de modelos a través del criterio BIC (ver Anexo
\ref{eleccion_efectos_aleatorios}) se decidió plantear un modelo de efectos
mixtos con ordenada aleatoria y estructura de covariancia autorregresiva de
orden 1. De esta manera, se incorpora al modelo la correlación serial y el
efecto entre pacientes. La CVT se incorpora en su forma original ya que se
evaluó su exogeneidad. El modelo resulta:

\begin{multline}
	\label{modelo_1}
	Y_{ij} = \beta_0 + b_{0i} + \beta_1\ sexo_i + \beta_2\ edad_i + \beta_3\ adherencia_{ij}
	+ \beta_4\ mes_j + \beta_5\ mes_j\ adherencia_{ij} + \varepsilon_{ij}
\end{multline}

Se supone que $\bm{\varepsilon}_i$ y $b_{0i}$ son independientes.

\[ 
	\bm{\varepsilon}_i = \begin{pmatrix} \varepsilon_{i1} \\ \vdots \\ \varepsilon_{in} \end{pmatrix} \sim N_{n}(0, \bm{R}_i)
	\quad
	b_{0i} = \sim N(0, Var(b_{0i}))
\]

Donde $\bm{R}_i$ es la matriz de variancias y covariancias del vector
$\bm{\varepsilon}_i$.

Los coeficientes del modelo estimado se presentan en la tabla
(\ref{modelo_1_tabla}). Como se mencionó anteriormente, la CVT adherencia contiene
ambos efectos entre e intra paciente, por lo tanto su coeficiente no será
facilmente interpretable. 

\begin{table}[H]
	\centering
	\caption{Modelo 1}
	\label{modelo_1_tabla}
	\input{tables/modelo_1}
\end{table}

Manteniendo constantes los efectos del sexo y la edad, en este caso en 0
(femenino) y 58,84 (edad media) respectivamente, los valores de TAS estimada
según los posibles perfiles adherencia por el modelo 1 pueden observarse en el
gráfico (\ref{modelo_1_plot}).

\hl{Los pacientes que adhieren al tratamiento presentan una disminución promedio
en su TAS de 1,322 unidades en su ordenada y 0,832 unidades por mes menores a
los pacientes que no adhieren. Es importante aclarar que, al ser la adherencia
una CVT, esto no es una pendiente y la TAS se ve afectada solo por la adherencia
en el mes actual. Es decir, si un paciente no adhiere al sexto mes, su TAS
promedio sera de 134,37 mmHg, mientras que si adhiere al mes 7, su TAS estimada
será 7,146 ($1,322 + 0,832 * 7$) unidades menor que la de un paciente que no
adhiere en el mes 7, al igual que un paciente que adhiere la totalidad de los
meses.}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{img/modelo_1.png}
	\caption{TAS estimada por modelo 1 vs adherencia a través del tiempo}
	\label{modelo_1_plot}
\end{figure}

\subsection{Distintas maneras de incorporar la adherencia al modelo lineal mixto}

Hay más de una manera de incorporar una CVT exógena a un modelo lineal mixto, en
esta sección compararemos algunas de ellas. Para los gráficos de los perfiles de
adherencia de cada modelo se mantendrán constantes el sexo y la edad en 0 y
58,84 respectivamente.

\subsubsection{Incorporación de covariable fija}

Hay diversas formas de convertir una CVT en CNVT, en este apartado se mostrarán
2 que resultan de interés para el estudio. Es importante destacar que éstas
transformaciones se pueden utilizar para incorporar CVT tanto exógenas como
endógenas.

Una de las transformaciones que puede aplicarse sobre la covariable adherencia
es convertirla en una variable dicotómica fija, cuyo valor es 1 si el paciente
adhirió en todo el tratamiento y 0 en otro caso. El modelo resulta:

\begin{multline}
	\label{modelo_2}
	Y_{ij} = \beta_0 + b_{0i} + \beta_1\ sexo_i + \beta_2\ edad_i + \beta_3\ adherencia\ perfecta_i \\
	+ \beta_4\ mes_j + \beta_5\ mes_j\ adherencia\ perfecta_i + \varepsilon_{ij}
\end{multline}

Se supone que $\bm{\varepsilon}_i$ y $b_{0i}$ son independientes.

\[ 
	\bm{\varepsilon}_i = \begin{pmatrix} \varepsilon_{i1} \\ \vdots \\ \varepsilon_{in} \end{pmatrix} \sim N_{n}(0, \bm{R}_i)
	\quad
	b_{0i} = \sim N(0, Var(b_{0i}))
\]

Donde $\bm{R}_i$ es la matriz de variancias y covariancias del vector
$\bm{\varepsilon}_i$.

En base a los resultados presentados en la tabla (\ref{modelo_2_tabla}),
controlando por el resto de las variables, \hl{los pacientes que adhieren en la
totalidad del tratamiento, presentan una TAS promedio menor en 2,579 unidades en
la ordenada y 0,257 unidades por mes.}. Dado que la adherencia se convirtió en
una CNVT, en este caso el coeficiente -0,257 si resulta una pendiente y los dos
perfiles de adherencia pueden observarse en el gráfico (\ref{modelo_2_plot}).

\begin{table}[H]
	\centering
	\caption{Modelo 2: Incorporación adherencia perfecta}
	\label{modelo_2_tabla}
	\input{tables/modelo_2}
\end{table}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{img/modelo_2.png}
	\caption{TAS estimada por modelo 2 vs adherencia perfecta a través del tiempo}
	\label{modelo_2_plot}
\end{figure}

Otra manera de incorporar la covariable fija, conservando más información, es
usar la proporción de adherencia total al final del estudio. Es decir, si de los
7 meses el paciente adhiere en solo 5, el valor que se le asignará es
$\frac{5}{7}$ ($\approx 0.71$). El modelo resulta:

\begin{multline}
	\label{modelo_3}
	Y_{ij} = \beta_0 + b_{0i} + \beta_1\ sexo_i + \beta_2\ edad_i + \beta_3\ \overline{adherencia}_i \\
	+ \beta_4\ mes_j + \beta_5\ mes_j\ \overline{adherencia}_i + \varepsilon_{ij}
\end{multline}

Se supone que $\bm{\varepsilon}_i$ y $b_{0i}$ son independientes.

\[ 
	\bm{\varepsilon}_i = \begin{pmatrix} \varepsilon_{i1} \\ \vdots \\ \varepsilon_{in} \end{pmatrix} \sim N_{n}(0, \bm{R}_i)
	\quad
	b_{0i} = \sim N(0, Var(b_{0i}))
\]

Donde $\bm{R}_i$ es la matriz de variancias y covariancias del vector
$\bm{\varepsilon}_i$.

Los coeficientes presentados en la tabla (\ref{modelo_3_tabla}) indican que,
controlando por el resto de las variables, \hl{los pacientes presentan una
disminución promedio de 1,598 en la TAS en relación a la proporción de
adherencia total en la ordenada al origen y luego disminuirá en 1,052 de manera
proporcional a la adherencia total por mes. Por ejemplo, un paciente que adhiere
sólo al 50\% del tratamiento, tendrá una disminución promedio en su TAS de 0,799
($1,598\ *\ 0.5$) al inicio del tratamiento y luego una disminución de 0,526 por
mes ($1,052\ *\ 0.5$).} Dado que la adherencia es una variable dicotómica, la
adherencia total solo puede tomar 8 posibles valores, estos perfiles pueden
observarse en el gráfico (\ref{modelo_3_plot}).

\begin{table}[H]
	\centering
	\caption{Modelo 3: incorporación adherencia total}
	\label{modelo_3_tabla}
	\input{tables/modelo_3}
\end{table}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{img/modelo_3.png}
	\caption{TAS estimada por modelo 3 vs adherencia total a través del tiempo}
	\label{modelo_3_plot}
\end{figure}

\subsubsection{Incorporación como CVT}

Se proponen otras dos maneras de incorporar la CVT al modelo, la adherencia en
el mes anterior y la adherencia promedio hasta el mes actual, ya que podria
pensarse que el tratamiento no es de efecto inmediato y la TAS podria estar
influenciada por la adherencia en meses anteriores.

El modelo utilizando la adherencia en el mes anterior resulta:

\begin{multline}
	\label{modelo_4}
	Y_{ij} = \beta_0 + b_{0i} + \beta_1\ sexo_i + \beta_2\ edad_i + \beta_3\ adherencia_{ij-1} \\
	+ \beta_4\ mes_j + \beta_5\ mes_j\ adherencia_{ij-1} + \varepsilon_{ij}
\end{multline}

Se supone que $\bm{\varepsilon}_i$ y $b_{0i}$ son independientes.

\[ 
	\bm{\varepsilon}_i = \begin{pmatrix} \varepsilon_{i1} \\ \vdots \\ \varepsilon_{in} \end{pmatrix} \sim N_{n}(0, \bm{R}_i)
	\quad
	b_{0i} = \sim N(0, Var(b_{0i}))
\]

Donde $\bm{R}_i$ es la matriz de variancias y covariancias del vector
$\bm{\varepsilon}_i$.

Los coeficientes de $adherencia_{ij-1}$ se interpretan de la misma manera que en
el modelo (\ref{modelo_1}), manteniendo constante el efecto del resto de las
covariables, \hl{los pacientes que adhieren al tratamiento en el mes anterior
presentan una aumento promedio en su TAS de 0,343 unidades en su ordenada al
origen, y una disminución 0,383 unidades por mes.}

Los valores de TAS estimada según los posibles perfiles adherencia por el modelo
4 pueden observarse en el gráfico (\ref{modelo_4_plot}).

\begin{table}[H]
	\centering
	\caption{Modelo 4: incorporación adherencia en el mes anterior}
	\label{modelo_4_tabla}
	\input{tables/modelo_4}
\end{table}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{img/modelo_4.png}
	\caption{TAS estimada por modelo 4 vs adherencia en el mes anterior a través del tiempo}
	\label{modelo_4_plot}
\end{figure}

La otra opción es usar la covariable proporción de adherencia hasta el mes
actual. Es decir, si en el mes 4 un paciente adhirio solo en 2 meses, su
adherencia promedio será de $\frac{2}{4}$ ($0.5$). Sin embargo, si adhiere en la
ocasión 5, entonces la adherencia promedio en ese mes será $\frac{3}{5}$
($0.6$). El modelo resulta:

\begin{multline}
	\label{modelo_5}
	Y_{ij} = \beta_0 + b_{0i} + \beta_1\ sexo_i + \beta_2\ edad_i + \beta_3\ overline{adherencia}_{ij} \\
	+ \beta_4\ mes_j + \beta_5\ mes_j\ \overline{adherencia}_{ij} + \varepsilon_{ij}
\end{multline}

Se supone que $\bm{\varepsilon}_i$ y $b_{0i}$ son independientes.

\[ 
	\bm{\varepsilon}_i = \begin{pmatrix} \varepsilon_{i1} \\ \vdots \\ \varepsilon_{in} \end{pmatrix} \sim N_{n}(0, \bm{R}_i)
	\quad
	b_{0i} = \sim N(0, Var(b_{0i}))
\]

Donde $\bm{R}_i$ es la matriz de variancias y covariancias del vector
$\bm{\varepsilon}_i$.

En la tabla (\ref{modelo_5_tabla}) se presentan los resultados del modelo. En este
caso, los coeficientes que acompañan a la covariable
$\overline{adherencia}_{ij}$ se multiplicarán por la proporcion de adherencia
del mes $j$. Tomando como ejemplo una adherencia perfecta
($\overline{adherencia}_{ij}$ = 1), manteniendo constante el efecto del resto de
las covariables, \hl{los pacientes que adhieren al tratamiento en todas las
ocasiones hasta la actual presentan una disminución promedio en su TAS de 2,608
en la ordenada al origen, y una disminución de 0,957 unidades por mes menores a
los pacientes que no adhieren en ninguna ocasión ($\overline{adherencia}_{ij}$ =
0).}

\begin{table}[H]
	\centering
	\caption{Modelo 5: incorporación adherencia acumulada}
	\label{modelo_5_tabla}
	\input{tables/modelo_5}
\end{table}

En el gráfico (\ref{modelo_5_plot}) pueden observarse los distintos perfiles de
adherencia que pueden ser estimados a través del modelo 5. A diferencia de los
modelos 1 y 4, en este caso la TAS estimada depende de todo el proceso de
adherencia y no solo del mes actual. En los modelos antes mencionados, la TAS
estimada en el mes 7 para un paciente que adhiere todo el tratamiento es la
misma que para un paciente que no adhiere los primeros 6 meses pero si adhiere
en el mes 7. En este modelo, la TAS estimada en el mes 7 para un paciente que
adhiere todo el tratamiento es de 127,03 mmHg, mientras que para un paciente que
no adhiere los primeros 6 meses pero si adhiere el último mes es de 135,01 mmHg.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{img/modelo_5.png}
	\caption{TAS estimada por modelo 5 vs adherencia acumulada través del tiempo}
	\label{modelo_5_plot}
\end{figure}

\subsubsection{Incorporación dividiendo efecto entre e intra}

Cuando la CVT es dicotómica, con 0 indicando la ausencia del atributo y 1 la
presencia, entonces $\overline{X}_i$ es la proporción en la que una persona
presentó el valor codificado con 1 de dicha covariable, por lo que el método
presentado en la sección (\ref{Dividiendo efecto entre-unidad y efecto
intra-unidad}) resultará en valores extraños para $\beta_W$ si usamos $X_i -
\overline{X}_i$. En este caso, si paciente adhirio al tratamiento en el 50\% de
los meses, $\overline{X}_i$ tendrá un valor de 0.5 y entonces el término que
acompaña a $\beta_W$ será de -0.5 en los meses que el paciente no adhiera y 0.5
en los meses que si adhiera. En términos de la estimación del modelo esto no
genera ningún problema, pero será confuso en la interpretación de los
parámetros, dado que el parámetro $\beta_W$ estará siempre presente (nunca
estará acompañado de un 0). Por lo tanto, para evitar esto, el efecto
intra-unidad estará acompañado solo de $X_{ij}$. El modelo resulta:

\begin{multline}
	\label{modelo_6}
	Y_{ij} = \beta_0 + b_{0i} + \beta_1\ sexo_i + \beta_2\ edad_i + \beta_{3}\ adherencia_{ij} + \beta_4\ \overline{adherencia}_i \\
	+ \beta_5\ mes_j + \beta_6\ mes_j\ adherencia_{ij} + \beta_7\ mes_j\ \overline{adherencia}_i + \varepsilon_{ij}
\end{multline}

Se supone que $\bm{\varepsilon}_i$ y $b_{0i}$ son independientes.

\[ 
	\bm{\varepsilon}_i = \begin{pmatrix} \varepsilon_{i1} \\ \vdots \\ \varepsilon_{in} \end{pmatrix} \sim N_{n}(0, \bm{R}_i)
	\quad
	b_{0i} = \sim N(0, Var(b_{0i}))
\]

Donde $\bm{R}_i$ es la matriz de variancias y covariancias del vector
$\bm{\varepsilon}_i$.

Los resultados pueden observarse en la tabla (\ref{modelo_6_tabla}). \hl{Los
coeficientes -1.866 y -0,641 quieren decir que, manteniendo constante la
proporción de adherencia total, se espera que los pacientes que adhieren al
tratamiento presenten una disminución promedio en la TAS de 1.866 en la ordenada
al origen y que esta disminuya en promedio 0,641 por cada mes en el que se
adhiere al tratamiento. Por otro lado, los coeficientes 0,678 y -0,533 quieren
decir que, después de controlar por la adherencia en ese mes, se espera que la
TAS el primer mes de tratamiento sea mayor en 0.662 unidades en relación a la
proporción de adherencia total y luego disminuya, en promedio, 0,525 unidades
por mes en proporcion a la adherencia total al tratamiento.}

\begin{table}[H]
	\centering
	\caption{Modelo 6: incorporación la adherencia dividiendo efecto entre e
	intra persona}
	\label{modelo_6_tabla}
	\input{tables/modelo_6}
\end{table}

En el gráfico (\ref{modelo_6_plot}) pueden observarse todos los posibles perfiles
de adherencia que pueden calcularse a través de este modelo. Las pendientes,
representadas con lineas discontinuas cuando el paciente no adhiere al siguiente
mes y con lineas completas cuando el paciente adhiere el siguiente mes, pueden
tener distintas pendientes según la adherencia total del paciente y éstas
representan el efecto entre individuo. A su vez, cada paciente puede cambiar de
grupo de adherencia mes a mes, representado con circulos cuando adhiere y con
cruces cuando no adhiere, estos puntos representan el efecto intra individuo.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{img/modelo_6.png}
	\caption{TAS estimada por modelo 6 vs adherencia y adherencia total a través del tiempo}
	\label{modelo_6_plot}
\end{figure}

\subsubsection{Comparación de los métodos}

\begin{table}[H]
	\centering
	\caption{AIC y BIC de los diferentes modelos}
	\label{comparacion}
	\begin{tabular}{*{3}{|c}|}
		\hline
		Modelo 			 & AIC 		& BIC 	   \\
		\hline
		Modelo 1		 & 30773.19 & 30829.66 \\
		Modelo 2 		 & 30820.06 & 30876.52  \\
		Modelo 3 		 & 30825.27 & 30881.73 \\
		Modelo 4 		 & 30838.47 & 30894.94 \\
		Modelo 5 		 & 30810.56 & 30867.02 \\
		Modelo 6 		 & 30775.39 & 30844.4 \\
		\hline
	\end{tabular}
\end{table}

En la tabla (\ref{comparacion}) se puede observar que, basándose en el AIC y el
BIC, el modelo que mejor ajusta los datos es el modelo 1 (\ref{modelo_1}), este
modelo incorpora la CVT en su forma natural sin aplicarse ninguna
transformación. El segundo modelo que mejor ajusta los datos es el modelo 6
(\ref{modelo_6}) el cual también incorpora la covariable en su forma natural y
además incorpora una transformación CNVT de ésta para dividir efectos y
facilitar la interpretación de sus parámetros.

\newpage

\section{Conclusiones}

Tradicionalmente, los modelos longitudinales fueron pensados para ser ajustados
sobre covariables fijas a través del tiempo, pero esto no es algo que suceda
siempre en la vida real.

En este informe se ha introducido una manera de categorizar a las covariables
variables en el tiempo, específicamente como \textit{exógenas} o
\textit{endógenas}, como así también un método para verificar esta clasificación
a través de ajustar disintos modelos individualmente para cada ocasión.

Cuando las variables son exógenas pueden añadirse al modelo de la manera
tradicional. Sin embargo, se han propuesto diversas transformaciones que pueden
ayudar tanto a ajustar de mejor manera los datos como a la interpretación de los
coeficientes.

También se mostró un ejemplo con un caso de estudio de pacientes de un programa
de atención y control de pacientes hipertensos. En base a estos datos se
ajustaron diferentes modelos con las distintas formas mencionadas de introducir
la CVT y se realizó una comparación de los mismos.

Como futuros pasos se propone estudiar más en profundidad la incorporación
de variables endógenas. Dado que muchas de las técnicas existentes hasta el
momento no están basadas en el ajuste de modelos lineales mixtos, quedan fuera
del alcance de esta tesina.

\newpage

\section{Anexo}

\subsection{Elección de efectos aleatorios y estructura de covariancia}
\label{eleccion_efectos_aleatorios}

\subsubsection{Efectos aleatorios}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.4]{img/semivariogram.png}
	\caption{Semivariograma muestral}
	\label{semivariogram}
\end{figure}

Para probar la significación de las efectos aleatorios se ajustaron 3 modelos,
uno con ordenada y pendiente aleatoria, otro solo con pendiente aleatoria y otro
solo con ordenada aleatoria. Los parametros de los 3 modelos fueron estimados
con el método de máxima verosimilitud restringida. El modelo completo es el
siguiente y sus resultados pueden observarse en la tabla (\ref{modelo_both}).

\[
	Y_{ij} = \beta_0 + b_{0i} + \beta_1\ sexo_i + \beta_2\ edad_i + \beta_3\ adherencia_{ij}
	+ \beta_4\ mes_j + \beta_5\ mes_j\ adherencia_{ij} + b_{1i}\ mes_j + \varepsilon_{ij}
\]

Se supone que $\bm{\varepsilon}_i$ y $\bm{b}_i$ son independientes.

\[ 
	\bm{\varepsilon}_i = \begin{pmatrix} \varepsilon_{i1} \\ \vdots \\ \varepsilon_{in} \end{pmatrix} \sim N_{n}(0, \bm{R}_i)
	\quad
	\bm{b}_i = \begin{pmatrix} b_{0i} \\ b_{1i} \end{pmatrix} \sim N_k(0, \bm{D})
\]

Donde $\bm{D}$ y $\bm{R}_i$ son las matrices de variancias y covariancias de los
vectores $\bm{b}_i$ y $\bm{\varepsilon}_i$ respectivamente.

Siendo \[
	Var(\bm{b_i}) = Var\begin{pmatrix} b_{0i} \\ b_{1i} \end{pmatrix}
	= \bm{D} = \begin{pmatrix} D_{00} & D_{01} \\ D_{10} & D_{11} \end{pmatrix}
\]

\begin{table}[H]
	\centering
	\caption{Modelo con ordenada y pendiente aleatoria}
	\label{modelo_both}
	\input{tables_anexo/modelo_both}
\end{table}

Se ajusta un modelo reducido solo con pendiente aleatoria, obteniendose los
resultados presentados en (\ref{modelo_time}):

\[
	Y_{ij} = \beta_0 + \beta_1\ sexo_i + \beta_2\ edad_i + \beta_3\ adherencia_{ij}
	+ \beta_4\ mes_j + \beta_5\ mes_j\ adherencia_{ij} + b_{1i}\ mes_j + \varepsilon_{ij}
\]

\begin{table}[H]
	\centering
	\caption{Modelo con pendiente aleatoria}
	\label{modelo_time}
	\input{tables_anexo/modelo_pendiente}
\end{table}

Y se plantea el siguiente test de hipótesis:

$ \left. H_0 \right) D_{00}\ =\ D_{01}\ =\ 0\ \quad\ \left. H_1\ \right) al\ menos\ uno\ distinto\ de\ cero $

Siendo $G^2 = (-2)*LogLikelihood$, MC el modelo completo y MR el modelo
reducido obtenemos:

$ G^2(MR) - G^2(MC) = 31144.28 - 30787.86 = 356.52 $

Al comparar este valor con una $\chi_{50:50;1;0.05} = 5.14$ resulta mayor, por
lo tanto se rechaza la hipótesis nula y se considera que se debe incluir la
ordenada al origen aleatoria.

Al repetir los mismos pasos para un modelo solo con ordenada aleatoria se
obtienen los resultados presentados en la tabla (\ref{modelo_intercept}):

\[
	Y_{ij} = \beta_0 + b_{0i} + \beta_1\ sexo_i + \beta_2\ edad_i + \beta_3\ adherencia_{ij}
	+ \beta_4\ mes_j + \beta_5\ mes_j\ adherencia_{ij} + \varepsilon_{ij}
\]

\begin{table}[H]
	\centering
	\caption{Modelo con ordenada aleatoria}
	\label{modelo_intercept}
	\input{tables_anexo/modelo_ordenada}
\end{table}

Se plantea el test de hipótesis:

$ \left. H_0 \right) D_{11}\ =\ D_{01}\ =\ 0\ \quad\ \left. H_1\ \right) al\ menos\ uno\ distinto\ de\ cero $

Siendo $G^2 = (-2)*Log-Likelihood$, MC el modelo completo y MR el modelo
reducido obtenemos:

$ G^2(MR) - G^2(MC) = 30838.98 - 30787.86 = 51.12 $

Al comparar este valor con una $\chi_{50:50;1;0.05} = 5.14$ vemos es que mayor,
por lo tanto se rechaza la hipótesis nula y se considera que se debe incluir la
pendiente aleatoria.

En base a este test, ambos efectos aleatorios son añadidos al modelo. Sin
embargo, al modelar la correlación serial con una estructura de covariancia
autorregresiva de orden 1, tanto con ordenada y pendiente aleatoria como con
solo ordenada aleatoria, se obtienen:

\begin{table}[H]
	\centering
	\caption{Modelo con ordenada aleatoria}
	\label{modelo_both_ar1}
	\input{tables_anexo/modelo_both_ar1}
\end{table}

\begin{table}[H]
	\centering
	\caption{Modelo con ordenada aleatoria}
	\label{modelo_intercept_ar1}
	\input{tables_anexo/modelo_ordenada_ar1}
\end{table}

Comparando estos modelos a través del criterio BIC, el que mejor ajusta los
datos es el modelo lineal mixto con ordenada aleatoria y estructura de
covariancia AR1, por lo tanto este será el modelo propuesto.

\newpage
\nocite{*}
\renewcommand{\refname}{Bibliografía}
\bibliography{Bibliografia}

\end{document}